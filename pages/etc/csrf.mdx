# CSRF(Cross-Site-Request-Forgery)
- 사이트 간 요청 위조의 준말
- 사용자가 자신의 의지와는 무관하게 공격자가 의도한 행위를 특정 웹사이트에 요청하게 하는 공격

# 동작원리
CSRF 공격을 성공할려면 아래와 같은 조건을 만족해야한다.

1. 사용자가 보안이 취약한 서버로부터 이미 인증을 받은 상태여야 한다.
2. 쿠키 기반으로 서버 세션 정보를 획득할 수 있어야 한다.
3. 공격자는 서버를 공격하기 위한 요청 방법에 대해 미리 파악하고 있어야 한다.

조건이 만족되었으면 아래와 같이 공격을 할 수 있다.

1. 사용자가 보안에 취약한 서버에 인증을 받는다.
    - 서버의 세션에는 사용자의 정보가 저장된다.
    - 브라우저 쿠키에는 세션 정보를 조회할 수 있는 세션 키를 받는다.
2. 공격자는 인증된 사용자가 악성 스크립트가 작성된 페이지를 누르도록 유도한다.
    - 일반적인 게시글이나 메일 등으로 전달하여 링크 클릭을 유도
    - 혹은 Img 태그로 특정 url로 요청을 보낼 수 있다. EX: 로그아웃
3. 사용자가 악성 스크립트가 담겨있는 페이지에 접속한다.
    - 악성 스크립트의 요청이 세션키가 담긴 쿠키와 함께 서버로 전달된다.
4. 서버는 쿠키를 보고 사용자의 요청으로 판단하여 처리

# 방어방법

## Referrer Check
- HTTP 요청 헤더 정보에서 Referrer 정보를 확인하여 호스트와 일치할 경우 승인

## CSRF Token
- 임의의 토큰을 세션에 저장 후 요청마다 해당 값과 비교

## CAPTCHA
- 특정한 단어를 요청과 함께 보내도록 하여 의도한 페이지에서 보내는 요청인지 확인

## 이중 제출 쿠키
- SOP(Same Origin Policy, 동일 출처 정책)에 의해 다른 도메인의 응답에 접근 할 수 없는 점을 이용
- 동일 출처에서만 통한다는 한계가 존재 