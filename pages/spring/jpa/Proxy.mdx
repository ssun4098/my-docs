# 프록시
- JPA는 연관관계의 엔티티를 조회하기 전까지는 데이터베이스 조회를 지연하는 방법을 사용하는데 이것을 지연로딩이라 한다.
- 그런데 지연 로딩 기능을 사용하려면 실제 엔티티 객체 대신에 데이터베이스를 지연할 수 있는 가짜 객체가 필요한데 이것을 프록시 객체

## 프록시 기초
- 엔티티를 조회할 때 영속성 컨텍스트에 엔티티가 없으면 DB를 조회한다.
- 엔티리를 실제 사용하는 시점까지 DB 조회를 미루고 싶다면 EntityManager.getReference() 메소드를 사용하면 된다.
- JPA에서 실제 엔티티 대신 DB 접근을 위임한  프록시 객체를 반환한다.

## 프록시의 특징
- 프록시 객체는 처음 사용할 때 한 번만 초기화된다.
- 프록시 객체를 초기화한다고 프록시 객체가 실제 엔티티로 바뀌는 것은 아니다. 프록시 객체가 초기화되면 프록시 객체를 통해서 실제 엔티티에 접근할 수 있다.
- 프록시 객체는 원본 엔티티를 상속받은 객체이므로 타입 체크 시에 주의해서 사용해야 한다.
- 영속성 컨텍스트에 찾는 엔티티가 이미 있으면 DB를 조회할 필요가 없으므로 getReference()를 호출해도 프록시가 아닌 실제 엔티티를 반환한다.
- 초기화는 영속성 컨텍스트의 도움을 받아야 가능한다. 따라서 영속성 컨텍스트의 도움을 받을 수 없는 준영속 상태의 프록시를 초기화하면 문제가 발생한다.

# 프록시와 식별자
- 엔티티를 프록시로 조회할 때 식별자 값을 파라미터로 전달하는데 프록시 객체는 이 식별자 값을 보관한다.
- 엔티티 접근 방식에 따라 프록시 객체가 초기화되냐 안되냐 달라진다.

# 프록시 확인
- PersistenceUnit.isLoaded(Object entity) 메소드를 사용하면 프록시 인스턴스의 초기화 여부를 확인 가능
- 조회한 엔티티가 진짜 엔티티인지 프록시로 조회한 것인지 확인하려면 클래스명을 직접 출력해보면 된다.(프록시를 생성하는 객체에 따라 클래스명이 달라질 수 있다.)